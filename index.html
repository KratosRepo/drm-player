<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>DRM Player — DASH &amp; HLS</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Play DRM-protected DASH and HLS streams with ClearKey support">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>▶</text></svg>">
  <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ── Player container ── */
    #jwplayerDiv { display: none; }
    .jwplayer { position: absolute !important; }
    .jwplayer.jw-flag-aspect-mode { min-height: 100%; max-height: 100%; }

    /* ── Form card ── */
    #videoForm {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 32px 28px;
      border-radius: 16px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    #videoForm.hidden {
      opacity: 0;
      transform: scale(0.95);
      pointer-events: none;
    }

    .form-title {
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 4px;
      background: linear-gradient(90deg, #e94560, #533483);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent;
    }

    .form-subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 24px;
    }

    .badge-row {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 3px 10px;
      border-radius: 20px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .badge.dash { background: #e94560; color: #fff; }
    .badge.hls  { background: #533483; color: #fff; }
    .badge.drm  { background: #0f3460; color: #7ec8e3; border: 1px solid #7ec8e3; }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #aaa;
      margin-bottom: 6px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 8px;
      font-size: 0.9rem;
      background: rgba(0, 0, 0, 0.25);
      color: #fff;
      transition: border-color 0.2s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #e94560;
    }
    input[type="text"]::placeholder { color: #666; }

    .optional-hint {
      font-size: 0.72rem;
      color: #666;
      margin-top: -12px;
      margin-bottom: 14px;
    }

    .btn-play {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #e94560, #533483);
      color: #fff;
      letter-spacing: 0.5px;
      transition: transform 0.15s, box-shadow 0.2s;
    }
    .btn-play:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(233, 69, 96, 0.4);
    }
    .btn-play:active { transform: translateY(0); }

    .error-msg {
      display: none;
      color: #ff6b6b;
      font-size: 0.82rem;
      text-align: center;
      margin-top: 12px;
      padding: 8px;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 6px;
    }

    /* ── Nav links ── */
    .nav-links {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .nav-links a {
      font-size: 0.75rem;
      color: #7ec8e3;
      text-decoration: none;
      padding: 4px 10px;
      border: 1px solid rgba(126, 200, 227, 0.3);
      border-radius: 20px;
      transition: background 0.2s;
    }
    .nav-links a:hover {
      background: rgba(126, 200, 227, 0.1);
    }
  </style>
</head>

<body>
  <div id="jwplayerDiv"></div>

  <form id="videoForm" onsubmit="return false;">
    <div class="form-title">DRM Player</div>
    <div class="form-subtitle">DASH &amp; HLS Streaming with ClearKey DRM</div>

    <div class="badge-row">
      <span class="badge dash">DASH / MPD</span>
      <span class="badge hls">HLS / M3U8</span>
      <span class="badge drm">ClearKey DRM</span>
    </div>

    <label for="manifest">Stream URL</label>
    <input type="text" id="manifest" placeholder="https://example.com/stream.mpd or .m3u8" required autofocus>

    <label for="keyId">Key ID</label>
    <input type="text" id="keyId" placeholder="e.g. 0cbc4d3b4fbd9af512acb2488bb42910">
    <div class="optional-hint">Optional — leave empty for non-DRM streams</div>

    <label for="key">Key</label>
    <input type="text" id="key" placeholder="e.g. 30528c4ef882954e5707cd1001d66121">
    <div class="optional-hint">Optional — leave empty for non-DRM streams</div>

    <button type="button" class="btn-play" onclick="playVideo()">&#9654;&ensp;Play Video</button>

    <div id="errorMsg" class="error-msg"></div>

    <div class="nav-links">
      <a href="mpdLI.html">Widevine Player</a>
      <a href="claper.html">Clappr Player</a>
      <a href="EMB.html">Quick Embed</a>
    </div>
  </form>

  <script>
    'use strict';

    /* ── Utilities ── */
    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name) || '';
    }

    function showError(msg) {
      const el = document.getElementById('errorMsg');
      el.textContent = msg;
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 5000);
    }

    function hideForm() {
      const form = document.getElementById('videoForm');
      form.classList.add('hidden');
      setTimeout(() => { form.style.display = 'none'; }, 400);
      document.getElementById('jwplayerDiv').style.display = 'block';
    }

    /* ── Wait for JWPlayer library ── */
    function waitForJWPlayer(timeout = 10000) {
      return new Promise((resolve, reject) => {
        const start = Date.now();
        (function check() {
          if (typeof jwplayer === 'function') return resolve();
          if (Date.now() - start > timeout) return reject(new Error('JWPlayer failed to load'));
          setTimeout(check, 100);
        })();
      });
    }

    /* ── Detect stream type from URL (handles query strings) ── */
    function getStreamType(url) {
      try {
        const pathname = new URL(url).pathname.toLowerCase();
        if (pathname.endsWith('.mpd')) return 'dash';
        return 'hls';
      } catch {
        // Fallback for relative or malformed URLs
        const clean = url.split('?')[0].split('#')[0].toLowerCase();
        if (clean.endsWith('.mpd')) return 'dash';
        return 'hls';
      }
    }

    /* ── Build player config ── */
    function buildConfig(manifest, keyId, key) {
      const config = {
        file: manifest,
        autostart: true,
        width: '100%',
        aspectratio: '16:9',
        stretching: 'uniform',
        type: getStreamType(manifest),
      };

      if (keyId && key) {
        config.drm = { clearkey: { keyId, key } };
      }

      return config;
    }

    /* ── Play from form ── */
    async function playVideo() {
      const manifest = document.getElementById('manifest').value.trim();
      const keyId    = document.getElementById('keyId').value.trim();
      const key      = document.getElementById('key').value.trim();

      if (!manifest) return showError('Please enter a stream URL');

      try {
        await waitForJWPlayer();
      } catch {
        return showError('JWPlayer library failed to load. Check your connection.');
      }

      hideForm();
      const player = jwplayer('jwplayerDiv').setup(buildConfig(manifest, keyId, key));
      player.on('error', (e) => showError('Playback error: ' + (e.message || 'Unknown error')));
      player.on('setupError', (e) => showError('Setup error: ' + (e.message || 'Could not initialize player')));
    }

    /* ── Enter key support ── */
    document.getElementById('videoForm').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        playVideo();
      }
    });

    /* ── Auto-play from URL params ── */
    (async function autoPlay() {
      const fileUrl = getParam('emmbed-url') || getParam('embed-url');
      if (!fileUrl) return;

      const kid = getParam('kid');
      const key = getParam('key');

      try {
        await waitForJWPlayer();
      } catch {
        return showError('JWPlayer library failed to load.');
      }

      hideForm();
      const player = jwplayer('jwplayerDiv').setup(buildConfig(fileUrl, kid, key));
      player.on('error', (e) => showError('Playback error: ' + (e.message || 'Unknown error')));
      player.on('setupError', (e) => showError('Setup error: ' + (e.message || 'Could not initialize player')));
    })();
  </script>
</body>

</html>
